<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AnalogButtons: ⚠ &lt;strong&gt;IMPORTANT&lt;/strong&gt;</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AnalogButtons
   </div>
   <div id="projectbrief">Arduino multi button support library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">⚠ <b>IMPORTANT</b> </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_README"></a> </p><blockquote class="doxtable">
<p >Please, before submitting a support request read carefully this README and check if an answer already exists among <a href="https://github.com/rlogiacco/AnalogButtons/discussions">previously answered questions</a>: do not abuse of the Github issue tracker. </p>
</blockquote>
<h1><a class="el" href="class_analog_buttons.html">AnalogButtons</a> <a href="https://github.com/rlogiacco/AnalogButtons/stargazers"><img src="https://img.shields.io/github/stars/rlogiacco/AnalogButtons.svg?style=social&amp;label=Star" alt="GitHub stars" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/rlogiacco/AnalogButtons/network"><img src="https://img.shields.io/github/forks/rlogiacco/AnalogButtons.svg?style=social&amp;label=Fork" alt="GitHub forks" style="pointer-events: none;" class="inline"/></a> </h1>
<p ><a href="https://github.com/rlogiacco/AnalogButtons/releases"><img src="https://img.shields.io/github/release/rlogiacco/AnalogButtons.svg" alt="GitHub version" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/rlogiacco/AnalogButtons/releases/latest"><img src="https://img.shields.io/github/downloads/rlogiacco/AnalogButtons/total.svg" alt="GitHub download" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/rlogiacco/AnalogButtons/stargazers"><img src="https://img.shields.io/github/stars/rlogiacco/AnalogButtons.svg" alt="GitHub stars" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/rlogiacco/AnalogButtons/issues"><img src="https://img.shields.io/github/issues/rlogiacco/AnalogButtons.svg" alt="GitHub issues" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/rlogiacco/AnalogButtons/actions/workflows/main.yml"><img src="https://github.com/rlogiacco/AnalogButtons/actions/workflows/main.yml/badge.svg" alt="Build Status" style="pointer-events: none;" class="inline"/></a> <a href="https://github.com/rlogiacco/AnalogButtons/blob/master/LICENSE"><img src="https://img.shields.io/badge/license-LGPL%203-blue.svg" alt="License" style="pointer-events: none;" class="inline"/></a></p>
<p >In order to reduce the number of pins used by some projects, sketches can use this library to wire multiple buttons to one single analog pin.</p>
<ul>
<li><a href="#features">Features</a></li>
<li><a href="#usage">Usage</a><ul>
<li><a href="#1-buttons-definition">1. Buttons definition</a></li>
<li><a href="#2-analog-pin-definition">2. Analog pin definition</a></li>
<li><a href="#3-setup">3. Setup</a></li>
<li><a href="#4-periodic-verification">4. Periodic verification</a></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Features</h1>
<p >You can register a call-back function which gets called when a button is pressed or held down for the defined number of seconds.</p>
<p >Includes a software simple de-bouncing algorithm which can be tweaked and is based on the max sampling frequency of 50Hz (one sample every 20ms)</p>
<p >Minimum hold duration (time that must elapse before a button is considered being held) and hold interval (time that must elapse between each activation of the hold function) can both be configured.</p>
<p >By default max number of buttons per pin is limited to 8 to limit memory consumption, but it can be controlled defining the <code>ANALOGBUTTONS_MAX_SIZE</code> macro <em><b>before</b></em> including this library.</p>
<p >Starting from version <code>1.2.0</code>:</p>
<ul>
<li>the maximum sampling frequency can be controlled defining the <code>ANALOGBUTTONS_SAMPLING_INTERVAL</code> macro, defaulting to 20</li>
<li>holding a button does not imply a <em>click</em> event being fired, greatly simplifying writing complex user interfaces</li>
</ul>
<p >This work is largely inspired by the <a class="el" href="class_analog_buttons.html">AnalogButtons</a> library available in the Arduino Playground library collection, but it represents a substantial improvement in terms of code organization as each operation is going to be defined in a separate function removing the need to determine (through <code>if</code> or <code>switch</code> statements) which button has been pressed/held.</p>
<p >Contributions are welcome under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html">Apache Public License version 2.0</a>.</p>
<p >For wiring instructions please refer to the <a href="https://raw.githubusercontent.com/rlogiacco/AnalogButtons/master/schematic.png">sample schematics</a> or, if you prefer, to the <a href="https://raw.githubusercontent.com/rlogiacco/AnalogButtons/master/breadboard.png">sample breadboard</a>.</p>
<p >Also, a test rig is available on <a href="https://circuits.io/circuits/4718116-analogbuttons">Autodesk Circuits</a> to play with the code and experiment with alternative layouts.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Usage</h1>
<p >Basically, the library usage can be divided into the following four steps.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
1. Buttons definition</h2>
<p >Each button is defined in isolation in terms of:</p>
<ul>
<li>an associated <code>value</code> (an unsigned 10-bit integer in the [0-1023] range)</li>
<li>a <code>click function</code> executed upon button click</li>
<li>a <code>hold function</code> executed once the button is identified as <em>being held</em> (defaults to click function)</li>
<li>a <code>hold duration</code> determining the number of milliseconds the button must remain pressed before being identified as held down (defaults to 1 second)</li>
<li>a <code>hold interval</code> determining the number of milliseconds between each activation of the <em>hold function</em> while the button is kept pressed (defaults to 250 milliseconds)</li>
</ul>
<p >In its simplest form, a button definition resemble something like the following which defines a button with only a click function.</p>
<div class="fragment"><div class="line">void aButtonClick() {</div>
<div class="line">  // do something</div>
<div class="line">}</div>
<div class="line">Button aButton = Button(512, &amp;aButtonClick);</div>
</div><!-- fragment --><p >In its most evolved form, a button definition looks like the following.</p>
<div class="fragment"><div class="line">void aButtonClick() {</div>
<div class="line">  // do something</div>
<div class="line">}</div>
<div class="line">void aButtonHold() {</div>
<div class="line">  // do something else</div>
<div class="line">}</div>
<div class="line">Button aButton = Button(512, &amp;aButtonClick, &amp;aButtonHold, 5000, 50);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md4"></a>
2. Analog pin definition</h2>
<p >Because buttons will share the same analog pin some configuration is required in order to distinguish and manage the different buttons:</p>
<ul>
<li>the <code>analog pin</code> the buttons will be attached to</li>
<li>the <code>pin mode</code> to set on the analog pin, it can either be <code>INPUT</code> (default value) or <code>INPUT_PULLUP</code>, depending on your wiring layout</li>
<li>the <code>debounce frequency multiplier</code> which determines the minimum duration a button must remain pressed to be considered being <em>clicked</em> in order to avoid false positives (defaults to 5)</li>
<li>the <code>analog value margin</code> which takes into account slight resistance fluctuations and ADC errors transforming the button <em>value</em> into a range (defaults to 10)</li>
</ul>
<div class="fragment"><div class="line">AnalogButtons analogButtons = AnalogButtons(A2);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
3. Setup</h2>
<p >Once you have everything defined you need to link everything up, more than probably within your <code>setup()</code> function:</p>
<div class="fragment"><div class="line">analogButtons.add(aButton);</div>
<div class="line">analogButtons.add(anotherButton);</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md6"></a>
4. Periodic verification</h2>
<p >Now all you need is to periodically activate the analog buttons verification which checks the analog pin to determine if one of the many possible conditions occurred and fires the corresponding code. The following code goes into the <code>loop()</code> function and needs to be executed as often as possible: this means you shouldn't introduce any <code>delay(...)</code> statement in your code, otherwise the library will not work as expected:</p>
<div class="fragment"><div class="line">analogButtons.check();</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
